# Generated by Django 5.1.15 on 2025-12-23 20:00

from django.db import migrations, models


def create_default_message_templates(apps, schema_editor):
    MessageTemplate = apps.get_model("leads", "MessageTemplate")

    templates = [
        {
            "channel": "email",
            "title": "Comesul Beef â€“ alinhamento de padrÃ£o de compra (e-mail)",
            "subject": "GetAgro â€“ alinhamento de padrÃ£o de compra (gado de corte RS)",
            "body": "OlÃ¡, LÃºcio, tudo bem?\n\nAqui Ã© o Douglas (da lavanderia que atende a Comesul Beef na lavagem de uniformes).\n\nEstou estruturando um projeto no RS chamado GetAgro, com o objetivo de intermediar compra e venda de gado de corte com curadoria (vÃ­deo + dados completos) e acompanhamento atÃ© o fechamento. A ideia Ã© encaminhar apenas oportunidades alinhadas ao perfil de compra de vocÃªs, de forma padronizada e objetiva.\n\nPara eu dimensionar e jÃ¡ comeÃ§ar a enviar lotes no padrÃ£o correto, vocÃª poderia me informar, por gentileza:\n\n1) Categoria principal de compra (boi gordo, vaca descarte, novilho etc.)\n2) Peso mÃ­nimo/mÃ©dio e padrÃ£o de acabamento/idade (se aplicÃ¡vel)\n3) PreferÃªncia de raÃ§a/padrÃ£o (se houver)\n4) RegiÃ£o/raio de compra (ex.: atÃ© X km de Pantano Grande/RS)\n5) Forma e prazo de pagamento\n6) Melhor formato para envio das ofertas (WhatsApp com ficha + vÃ­deo, e/ou e-mail)\n\nCom isso eu consigo filtrar e te mandar somente o que realmente serve, sem tomar teu tempo.\n\nAtenciosamente,\nDouglas Herzog\nGetAgro\nRio Pardo/RS\n",
        },
        {
            "channel": "whatsapp",
            "title": "Comesul Beef â€“ follow-up apÃ³s e-mail (WhatsApp)",
            "subject": "",
            "body": "Oi, LÃºcio, tudo bem? Aqui Ã© o Douglas (lavanderia).\n\nTe enviei agora um e-mail no compras@comesulbeef.com.br sobre a GetAgro, pra alinhar o padrÃ£o de compra de vocÃªs e eu te mandar somente lotes de gado de corte dentro do perfil (com ficha + vÃ­deo).\n\nQuando puder, dÃ¡ uma olhada. Se preferir, eu resumo por aqui tambÃ©m.",
        },
        {
            "channel": "whatsapp",
            "title": "CaptaÃ§Ã£o de vendedor â€“ coleta de dados do lote (WhatsApp)",
            "subject": "",
            "body": "Oi, [NOME], aqui Ã© o Douglas. Tudo bem?\n\nEstou trabalhando com a GetAgro aqui no RS, fazendo a ponte entre quem vende gado de corte e compradores (incluindo frigorÃ­fico), com acompanhamento atÃ© fechar.\nComissÃ£o sÃ³ em negÃ³cio fechado: 1,5% do vendedor + 1,5% do comprador.\n\nSe vocÃª tiver lote pra vender, me manda por favor:\n1) Cidade/RS\n2) Categoria (boi gordo / novilho / vaca descarte / etc.)\n3) Quantidade de cabeÃ§as\n4) Peso mÃ©dio (ou faixa)\n5) VÃ­deo curto (30â€“60s) + 2â€“3 fotos\n6) PreÃ§o pedido (se tiver) ou â€œaceito propostaâ€\n\nCom isso eu jÃ¡ consigo encaminhar e te dar retorno rÃ¡pido.",
        },
        {
            "channel": "whatsapp",
            "title": "Oferta de lote â€“ ficha padrÃ£o (WhatsApp)",
            "subject": "",
            "body": "LOTE RS â€“ [CATEGORIA]\nğŸ“ Local: [Cidade/RS] (aprox. [X] km de Pantano Grande / Comesul)\nğŸ‚ Qtde: [N] cabeÃ§as\nâš–ï¸ Peso mÃ©dio: [___ kg] (faixa: [minâ€“max] se houver)\nğŸ§¬ PadrÃ£o/raÃ§a: [ex.: britÃ¢nico / cruzado / zebuÃ­no]\nğŸ“Œ CondiÃ§Ã£o: [a pasto / semiconfinado / confinamento]\nğŸ“… DisponÃ­vel: [imediato / data]\nğŸ’° PreÃ§o: [R$ ___] ou â€œaberto a propostaâ€\nğŸšš Frete: [por conta de ___]\nğŸ“¹ VÃ­deo/fotos: [anexo/link]\n\nSe tiver interesse, me responde â€œTENHO INTERESSEâ€ que eu jÃ¡ confirmo condiÃ§Ãµes e avanÃ§o com o vendedor.",
        },
        {
            "channel": "whatsapp",
            "title": "Follow-up comprador (WhatsApp)",
            "subject": "",
            "body": "Oi, [NOME]. Conseguiu ver o lote de [cidade]?\n\nSe nÃ£o estiver no padrÃ£o, me diz sÃ³:\n- categoria preferida\n- peso mÃ­nimo\n- faixa de preÃ§o\nque eu ajusto e te mando algo mais alinhado.",
        },
        {
            "channel": "whatsapp",
            "title": "Fechamento + comissÃ£o (WhatsApp)",
            "subject": "",
            "body": "Fechamos assim:\n\nâœ… Lote: [categoria] â€“ [N] cabeÃ§as â€“ [cidade/RS]\nâœ… PreÃ§o: R$ [___] ([por cabeÃ§a / por kg / total])\nâœ… Retirada/Entrega: [local/data]\nâœ… Pagamento: [forma/prazo]\nâœ… Frete: [quem paga]\n\nComissÃ£o de intermediaÃ§Ã£o (somente em negÃ³cio fechado):\n- 1,5% comprador\n- 1,5% vendedor\n\nSe estiver ok, eu confirmo com a outra parte e formalizo aqui por mensagem.",
        },
    ]

    for t in templates:
        MessageTemplate.objects.get_or_create(
            channel=t["channel"],
            title=t["title"],
            defaults={
                "subject": t["subject"],
                "body": t["body"],
                "is_active": True,
            },
        )


def remove_default_message_templates(apps, schema_editor):
    MessageTemplate = apps.get_model("leads", "MessageTemplate")
    MessageTemplate.objects.filter(
        title__in=[
            "Comesul Beef â€“ alinhamento de padrÃ£o de compra (e-mail)",
            "Comesul Beef â€“ follow-up apÃ³s e-mail (WhatsApp)",
            "CaptaÃ§Ã£o de vendedor â€“ coleta de dados do lote (WhatsApp)",
            "Oferta de lote â€“ ficha padrÃ£o (WhatsApp)",
            "Follow-up comprador (WhatsApp)",
            "Fechamento + comissÃ£o (WhatsApp)",
        ]
    ).delete()


class Migration(migrations.Migration):

    dependencies = [
        ("leads", "0003_lead_profile_fields_and_interest_other"),
    ]

    operations = [
        migrations.CreateModel(
            name="MessageTemplate",
            fields=[
                ("id", models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name="ID")),
                ("channel", models.CharField(choices=[("whatsapp", "WhatsApp"), ("email", "E-mail")], max_length=20)),
                ("title", models.CharField(max_length=160)),
                ("subject", models.CharField(blank=True, max_length=200)),
                ("body", models.TextField()),
                ("is_active", models.BooleanField(default=True)),
                ("created_at", models.DateTimeField(auto_now_add=True)),
                ("updated_at", models.DateTimeField(auto_now=True)),
            ],
            options={
                "ordering": ["channel", "title"],
            },
        ),
        migrations.RunPython(create_default_message_templates, remove_default_message_templates),
    ]
